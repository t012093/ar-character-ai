# API定義書

## プロジェクト名

AI Friend - 愛嬌とユーモアのあるパーソナルAI

## 1. 会話API

### 1.1 エンドポイント

`/chat`

### 1.2 メソッド

POST

### 1.3 リクエスト

* **ヘッダー:**
    * `Content-Type`: `application/json`
* **ボディ:**
```json
{
  "user_id": "ユーザーID",
  "message": "ユーザーの発話内容"
}
```

### 1.4 レスポンス

* **ステータスコード:** 200 OK
* **ボディ:**
```json
{
  "response": "AIフレンドの応答"
}
```

## 2. ユーザー管理API

### 2.1 ユーザー登録

#### 2.1.1 エンドポイント

`/register`

#### 2.1.2 メソッド

POST

#### 2.1.3 リクエスト

* **ヘッダー:**
    * `Content-Type`: `application/json`
* **ボディ:**
```json
{
  "email": "ユーザーのメールアドレス",
  "password": "パスワード"
}
```

#### 2.1.4 レスポンス

* **ステータスコード:** 201 Created
* **ボディ:**
```json
{
  "user_id": "新規登録されたユーザーのID"
}
```

### 2.2 ログイン

#### 2.2.1 エンドポイント

`/login`

#### 2.2.2 メソッド

POST

#### 2.2.3 リクエスト

* **ヘッダー:**
    * `Content-Type`: `application/json`
* **ボディ:**
```json
{
  "email": "ユーザーのメールアドレス",
  "password": "パスワード"
}
```

#### 2.2.4 レスポンス

* **ステータスコード:** 200 OK
* **ボディ:**
```json
{
  "access_token": "認証用アクセストークン"
}
```

### 2.3 ログアウト

#### 2.3.1 エンドポイント

`/logout`

#### 2.3.2 メソッド

POST

#### 2.3.3 リクエスト

* **ヘッダー:**
    * `Authorization`: `Bearer アクセストークン`

#### 2.3.4 レスポンス

* **ステータスコード:** 204 No Content

### 2.4 ユーザー情報取得

#### 2.4.1 エンドポイント

`/users/{user_id}`

#### 2.4.2 メソッド

GET

#### 2.4.3 リクエスト

* **ヘッダー:**
    * `Authorization`: `Bearer アクセストークン`

#### 2.4.4 レスポンス

* **ステータスコード:** 200 OK
* **ボディ:**
```json
{
  "user_id": "ユーザーID",
  "email": "ユーザーのメールアドレス"
}
```

## 3. 感情認識API

### 2.1 エンドポイント

`/analyze_emotion`

### 2.2 メソッド

POST

### 2.3 リクエスト

* **ヘッダー:**
    * `Content-Type`: `audio/wav` またはその他の音声フォーマット
* **ボディ:**
    * 音声データ (バイナリ)

### 2.4 レスポンス

* **ステータスコード:** 200 OK
* **ボディ:**
```json
{
  "emotion": "認識された感情 (喜び, 悲しみ, 怒り, 恐れ, 平常)"
}
```

## 4. 認証

APIへのアクセスは、以下の認証方式をサポートします。

### 4.1 Bearer認証（JWT）

ユーザー登録またはログインAPIの成功時に発行されるアクセストークン（JWT）を、リクエストヘッダーに含めて認証を行います。

* **対象API:** `/chat`, `/analyze_emotion`, `/users/{user_id}`, `/logout`
* **ヘッダー:**
  ```
  Authorization: Bearer <アクセストークン>
  ```

### 4.2 メールアドレスとパスワード認証

ユーザー登録およびログインAPIで、メールアドレスとパスワードによる認証を行います。

* **対象API:** `/register`, `/login`
* **リクエストボディ:**
  ```json
  {
    "email": "ユーザーのメールアドレス",
    "password": "パスワード"
  }
  ```

### 4.3 Googleログイン

ユーザー登録およびログインAPIで、Googleアカウントによる認証を行います。

* **対象API:** `/register`, `/login`
* **認証フロー:**
  1. クライアントはGoogle Sign-In SDKを用いてユーザーのGoogleアカウントでの認証を行います。
  2. 認証が成功すると、GoogleからIDトークンが発行されます。
  3. クライアントは、このIDトークンをサーバーの認証APIに送信します。
  4. サーバーは、Googleの公開鍵を用いてIDトークンの署名を検証し、トークンが有効であることを確認します。
  5. 検証に成功した場合、サーバーはユーザーを認証し、アクセストークン（JWT）を発行します。

## 4. エラーハンドリング

APIのエラーレスポンスの形式について記述する。

```json
{
  "error": {
    "code": "エラーコード",
    "message": "エラーメッセージ"
  }
}
